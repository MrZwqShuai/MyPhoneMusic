'usestrict'varAudioFace={}AudioFace.music={}AudioFace.music.AudioM=function(Songname,URL,element,element1,element2){this.element=element;this.element1=element1;this.element2=element2;this.name=Songnamethis.init();this.audioPlay();this.audioControl(element);this.audioPlay(element);this.audioloadData();this.loadImg(this.back);this.addHeart();};AudioFace.music.AudioM.prototype={constructor:AudioFace.music.AudioM,init:function(){this.Audio=document.querySelector('#myAudio');this.Audio.loop=true;//当前播放索引this.currentIndex=-1;},playpause:function(element,element1){var_self=this;this.Audio.addEventListener('pause',function(){clearInterval(_self.run);$(element).removeClass(element1);});this.Audio.addEventListener('playing',function(){$(element).addClass(element1);});},//监听播放audioPlay:function(element,element1,element2,element3,element4,element5,element6,element7){var_self=this;$(element).on('tap',function(){_self.Audio.addEventListener('loadstart',function(){this.Loadtext="正在加载";$('.xmpartist').html(this.Loadtext);},false);_self.Audio.addEventListener('canplaythrough',function(){$('.xmpartist').html(singer);$('.xmpname').html(songN);$(element2).addClass(element1);$(element3).addClass(element4);});_self.Audio.addEventListener('error',function(){this.Ftext="加载失败";$('.xmpname').html(this.Ftext);},false);_self.currentIndex=Number($(this).index())/2;console.log(_self.currentIndex)_self.Audio.src=_self.arr[_self.currentIndex];_self.Audio.play();_self.audioLrcParse(element5,element6,element7,_self.currentIndex);_self.toggleImg($('.t-imgimg'),_self.currentIndex);varsongN=$(this).attr('name');varsinger=$(this).attr('singer');$('.xmpartist').html(singer);})},//播放暂停audioControl:function(element,element1,element3){var_self=this;$(element).on('tap',function(){_self.playpause(element,element1);if(!_self.Audio.paused){_self.Audio.pause();$(element3).css({'right':'0rem','animation':'none','-webkit-animation':'none'})}else{_self.Audio.play();$(element3).css({'right':'-2.2rem','animation':'rotate4s.5slinearinfinite','-webkit-animation':'rotate4s.5slinearinfinite','animation-delay':'1.8s','-webkit-animation-delay':'1.8s'})}})},addHeart:function(){var_self=this;varstrMeruKey="memMenuTitle";vararrdisplay=[];for(vari=0;i<$('.heart-img').length;i++){arrdisplay[i]=0;}functionfnStoredisplay(){arrdisplay[_self.index]=(_self.sign===false?1:0);if(window.localStorage){console.log(arrdisplay);localStorage.setItem(strMeruKey,arrdisplay);}}$('.heart-img').on('tap',function(){varindexF=$(this).index();_self.index=indexF/2-0.5;_self.sign=$(this).hasClass('heart-img1');if(_self.sign===false){$('.heart-img').eq(_self.index).addClass('heart-img1');}else{$('.heart-img').eq(_self.index).removeClass('heart-img1');}fnStoredisplay();returnfalse;})varstrstoreDate=window.localStorage.getItem(strMeruKey);arrdisplay=strstoreDate.split(',');if(strstoreDate){strstoreDate.split(',').forEach(function(display,index){if(display==0){$('.heart-img').eq(index).removeClass('heart-img1');}else{$('.heart-img').eq(index).addClass('heart-img1');}})}console.log(strstoreDate.split(','))},//图片预加载loadImg:function(callback){this.toggleImg();vararrImg=['images/heart-img2','images/heart-img1','images/1.jpeg','images/3.jpeg','images/111.jpg','images/return.png','images/mingren.jpg','images/img.jpg','images/play_play.png','images/play_pause.png','images/play_next.png','images/play_prev.png','images/1_02.png','images/cd185.png','images/line.png','images/skin.png'];this.imgArr.push(arrImg);if(document.images){varimg=newImage();for(vari=0;i<this.imgArr.length;i++){img[i]=newImage();img[i].src=this.imgArr[i];}}if(img.complete){callback.call(img);return;}img.onload=function(){callback.call(img);};},back:function(){console.log('success');},toggleImg:function(ele,index){var_self=this;_self.imgArr=['http://y.gtimg.cn/music/photo_new/T002R300x300M000003RMaRI1iFoYd.jpg?max_age=2592000','http://y.gtimg.cn/music/photo_new/T002R300x300M000003RMaRI1iFoYd.jpg?max_age=2592000','http://y.gtimg.cn/music/photo_new/T001R300x300M000003ZQQb64D5317.jpg?max_age=2592000','http://y.gtimg.cn/music/photo_new/T002R300x300M000003K4mFV3B9UfM.jpg?max_age=2592000','http://y.gtimg.cn/music/photo_new/T002R300x300M000001sKd2l0dVkXa.jpg','http://y.gtimg.cn/music/photo_new/T002R300x300M000004CFwog26ax08.jpg','http://img.xiami.net/images/album/img0/3557921258599818_2.jpg','http://img.xiami.net/images/album/img69/7169/5100191335342155_2.jpg','http://img.xiami.net/images/album/img54/173854/1297173854_2.jpg','http://img.xiami.net/images/album/img58/3058/154291468997051_2.jpg','http://img.xiami.net/images/album/img69/7169/965946861397635527_2.jpg','http://img.xiami.net/images/album/img42/442/19261378203144_2.jpg','http://img.xiami.net/images/album/img58/23258/3207771470901509_2.jpg','http://img.xiami.net/images/album/img52/7052/3682971265854129_2.jpg','http://img.xiami.net/images/album/img86/773286/7732861412773286_2.jpg','http://img.xiami.net/images/album/img39/2739/145831376589249_2.jpg','http://img.xiami.net/images/album/img24/61224/15222071141472178795_2.jpg','http://img.xiami.net/images/album/img58/23258/4314411300697056_2.jpg','http://img.xiami.net/images/album/img69/7169/4217651472021043_2.jpg','http://img.xiami.net/images/album/img12/55712/20080783461411725324_2.jpg','http://img.xiami.net/images/album/img60/63760/3414911358479166_2.jpg','http://img.xiami.net/images/album/img66/7366/4324541301473658_2.jpg','http://img.xiami.net/images/album/img66/7366/3141491397734019_2.jpg','http://img.xiami.net/images/album/img94/83094/4175261470897820_2.jpg','http://img.xiami.net/images/album/img66/7366/3967281289900657_2.jpg','http://img.xiami.net/images/album/img39/2739/32927_2.jpg','http://img.xiami.net/images/album/img64/1164/57681417575958_2.jpg','http://img.xiami.net/images/album/img66/7366/170711_2.jpg','http://img.xiami.net/images/album/img83/123483/5619081355304243_2.png','http://img.xiami.net/images/album/img83/2075780083/5373969721437396972_2.jpg','http://img.xiami.net/images/album/img79/23979/1709891387951723_2.jpg'];$(ele).attr('src',_self.imgArr[index]);},animate:function(element,element1,element2,element3,element4){var_self=this;$(element).on('tap',function(){$(element1).css({'transform':'translate3D(0,0,0)','-webkit-transform':'translate3d(0,0,0)'})})$(element4).on('tap',function(){$(element1).css({'transform':'translate3D(0,100%,0)','-webkit-transform':'translate3d(0,100%,0)'})})//监听icon-play事件this.Audio.addEventListener('canplaythrough',function(){if(!_self.Audio.paused){$(element3).css({'right':'-2.2rem','animation':'rotate4s.5slinearinfinite','-webkit-animation':'rotate4s.5slinearinfinite','-moz-animation':'rotate4s.5slinearinfinite','-ms-animation':'rotate4s.5slinearinfinite','-o-animation':'rotate4s.5slinearinfinite','-o-animation-delay':'1.8s','-moz-animation-delay':'1.8s','-ms-animation-delay':'1.8s','-webkit-animation-delay':'1.8s','animation-delay':'1.8s'})}else{$(element2).on('tap',function(){})}});},//播放进度audioProcess:function(element,element1,element2,element3){var_self=this;vartotaltimer=0;this.Audio.addEventListener('canplaythrough',function(){totaltimer=_self.Audio.duration;varm=parseInt(_self.Audio.duration/60);vars=parseInt(_self.Audio.duration%60);m=m<10?'0'+m:m;s=s<10?'0'+s:s;$(element).html(m+':'+s);$(element2).on('touchstart',function(e){vartouch=e.targetTouches[0];varev=e||windwo.event;varx=touch.clientX;vary=touch.clientY;varl=touch.offsetLeft;vart=touch.offsetTop;_self.Audio.pause();$(element2).on('touchmove',function(e){varev=e.targetTouches[0];varX=ev.clientX;varchaX=X-x;if(chaX<=0)chaX=0;_self.MW=$('.progress-line').width()-$(this).width();if(chaX>=_self.MW)chaX=_self.MW;varper=chaX/_self.MW;_self.Audio.pause();document.querySelector(element3).style.width=chaX+'px';document.querySelector(element2).style.left=chaX+'px';//document.querySelector(element2).style.left=_self.p;_self.Audio.currentTime=per*totaltimer;});$(element2).on('touchend',function(e){$(element2).off('touchstart');_self.Audio.play();})})});this.Audio.addEventListener('timeupdate',function(){varM=parseInt(_self.Audio.currentTime/60);varS=parseInt(_self.Audio.currentTime%60);_self.MW=$('.progress-line').width()-$(this).width();M=M<10?'0'+M:M;S=S<10?'0'+S:S;$(element1).html(M+':'+S);_self.p=parseInt(_self.Audio.currentTime/_self.Audio.duration*100)+'%';document.querySelector(element3).style.width=_self.p;document.querySelector(element2).style.left=_self.p;});//拖拽$('.real-line').on('touchstart',function(e){vare=e.targetTouches[0];varxx=e.clientX;varnxx=xx-this.parentElement.offsetLeft;varper1=nxx/this.parentElement.offsetWidth;document.querySelector(element3).style.width=per1*100+'%';document.querySelector(element2).style.left=per1*100+'%';_self.Audio.currentTime=per1*totaltimer;_self.Audio.play();})$('.real-line').on('touchstart',function(e){$(element2).off('touchstart');})},//切换下一首audioNext:function(element,element1,element2,element3,element4,element5,element6){var_self=this;$(element).on('tap',function(){if(_self.currentIndex==($('.musiclist').length-1)){_self.currentIndex=0;}else{_self.currentIndex++;}_self.Audio.src=_self.arr[_self.currentIndex];_self.Audio.play();_self.Audio.addEventListener('canplaythrough',function(){varsinger=_self.arr2[_self.currentIndex];varsongN=_self.arr1[_self.currentIndex];$('.xmpartist').html(singer);$('.xmpname').html(songN);$(element2).addClass(element3);});_self.audioLrcParse(element4,element5,element6,_self.currentIndex);_self.toggleImg($('.t-imgimg'),_self.currentIndex);varsinger=$(element1).attr('singer')});},//上一首audioPrev:function(element,element1,element2,element3,element4,element5,element6){var_self=this;$(element).on('tap',function(){if(_self.currentIndex==0){_self.currentIndex=($('.musiclist').length-1);}else{_self.currentIndex--;}_self.Audio.src=_self.arr[_self.currentIndex];_self.Audio.play();_self.Audio.addEventListener('canplaythrough',function(){varsinger=_self.arr2[_self.currentIndex];varsongN=_self.arr1[_self.currentIndex];$('.xmpartist').html(singer);$('.xmpname').html(songN);$(element2).addClass(element3);});_self.audioLrcParse(element4,element5,element6,_self.currentIndex);_self.toggleImg($('.t-imgimg'),_self.currentIndex);varsinger=$(element1).attr('singer')})},//歌词解析audioLrcParse:function(element1,element2,element3,lrcIndex){var_self=thisvarsonglrc=this.arr3;varLyrics=/([\d{2}:\d{2}\.\d{2}]+)([^\[]+)/g;_self.arrTime=[];vararrLrc=[];varEllist=$(element1).find('li');if(Ellist.length!=0){Ellist.remove();arrLrc=[];}//歌词时间分割while(Lyrics.exec(songlrc[lrcIndex])){varaa=RegExp.$1.split(':');varAa=RegExp.$2.replace(/[\[\]]/g,'');varminute=parseInt(aa[0])*60*1000;//分钟varsecond=parseInt(aa[1])*1000;varmillisecond=parseInt(parseFloat(aa[1])%1*100);vartotaltime=minute+second+millisecond;_self.arrTime.push(totaltime);arrLrc.push(Aa);}for(vari=0;i<arrLrc.length;i++){varlrcLi='<li>'+arrLrc[i]+'</li>';$(element1).append(lrcLi);}//歌词同步_self.run=setInterval(function(){//只执行了一次varnowTime=parseInt(_self.Audio.currentTime);for(vartin_self.arrTime){//这里数组不应该有之前的数组if(parseInt(_self.arrTime[t]/1000)==(nowTime)){varHeight=$(element2).height();varheight=$(element3).eq(t).height();$(element1).find('li').eq(t).addClass('m3').siblings().removeClass('m3');$(element1).css({'transform':'translate3D(0,'+(Height/2-t*height)+'px,0)','-webkit-transform':'translate3D(0,'+(Height/2-t*height)+'px,0)'});}}},1000);},//获取json数据audioloadData:function(){var_self=this;vararr=newArray();vararr1=newArray();vararr2=newArray();vararr3=newArray();varnum=0,$list=$('.container');loadData($list,num);functionloadData($ele,num){$.ajax({url:'json/music.json',async:false,success:function(data){varstr='';varindex=0;$.each(data,function(i,item){arr[index]=item.songSrc;arr1[index]=item.songName;arr2[index]=item.Singer;arr3[index]=item.songlrc;index=index+1;str+=['<liclass="musiclist"singer='+item.Singer+'path="'+item.songSrc+'"name="'+item.songName+'">'+'<span></span>'+'<div>'+item.songName+'<br>'+item.Singer+'</div></li><iclass="heart-img"></i>'].join('');})$list.append(str);_self.arr=arr;_self.arr1=arr1;_self.arr2=arr2;_self.arr3=arr3;},error:function(){alert('请求失败')}})}}}
